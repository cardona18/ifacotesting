<?xml version="1.0" encoding="UTF-8" ?>
<odoo>
    <data>

        <!-- SALE ORDER INHERIT VIEWS -->

        <record id="stock_picking_sales_form" model="ir.ui.view">
            <field name="name">stock.picking.sales.form</field>
            <field name="model">stock.picking</field>
            <field name="inherit_id" ref="stock.view_picking_form"/>
            <field name="arch" type="xml">

                <xpath expr="//field[@name='scheduled_date']" position="after">
                    <field name="delivery_date" attrs="{'invisible': [('sale_shipment', '=', False)]}"/>
                </xpath>

                <xpath expr="//field[@name='origin']" position="after">
                    <field name="invoice_cfdi_id" readonly="1" attrs="{'invisible': [('sale_shipment', '=', False)]}"/>
                    <field name="shipment_cfdi_id" readonly="1" attrs="{'invisible': [('sale_shipment', '=', False)]}"/>
                    <field name="shipping_guide_id" attrs="{'invisible': [('sale_shipment', '=', False)]}"/>
                </xpath>

                <xpath expr="//div[@name='button_box']//button[1]" position="before">
                    <button name="sales_gi.shipping_label_picking_request" type="action" class="oe_stat_button" icon="fa-barcode" attrs="{'invisible': [('sale_shipment', '=', False)]}">
                        <field string="Etiquetas" name="labels_count" widget="statinfo"/>
                    </button>
                </xpath>

                <xpath expr="//page[last()]" position="inside">
                    <field name="sale_shipment" invisible="1"/>
                    <field name="operation_type" invisible="1"/>
                </xpath>

            </field>

        </record>

        <record id="create_cfdi_invoice_action" model="ir.actions.server">
            <field name="name">Crear Factura</field>
            <field name="type">ir.actions.server</field>
            <field name="model_id" ref="stock.model_stock_picking"/>
            <field name="binding_model_id" ref="stock.model_stock_picking"/>
            <field name="state">code</field>
            <field name="code">action = records.shipment_invoices()</field>
        </record>

        <record id="create_shipment_invoice_action" model="ir.actions.server">
            <field name="name">CFDI de Traslado</field>
            <field name="type">ir.actions.server</field>
            <field name="model_id" ref="stock.model_stock_picking"/>
            <field name="binding_model_id" ref="stock.model_stock_picking"/>
            <field name="state">code</field>
            <field name="code">action = records.shipment_invoices(True)</field>
        </record>

        <record id="create_shipment_labels_action" model="ir.actions.server">
            <field name="name">Etiquetas de embarque</field>
            <field name="type">ir.actions.server</field>
            <field name="model_id" ref="stock.model_stock_picking"/>
            <field name="binding_model_id" ref="stock.model_stock_picking"/>
            <field name="state">code</field>
            <field name="code">action = records.action_create_labels()</field>
        </record>

        <record id="create_shipment_guide_action" model="ir.actions.server">
            <field name="name">Guía de embarque</field>
            <field name="type">ir.actions.server</field>
            <field name="model_id" ref="stock.model_stock_picking"/>
            <field name="binding_model_id" ref="stock.model_stock_picking"/>
            <field name="state">code</field>
            <field name="code">action = records.action_shipping_guide()</field>
        </record>

        <record id="remove_shipment_guide_action" model="ir.actions.server">
            <field name="name">Quitar guía de embarque</field>
            <field name="type">ir.actions.server</field>
            <field name="model_id" ref="stock.model_stock_picking"/>
            <field name="binding_model_id" ref="stock.model_stock_picking"/>
            <field name="state">code</field>
            <field name="code">action = records.action_remove_shipping_guide()</field>
        </record>

        <!-- PENDING SALE SHIPMENTS ACTION -->

        <record id="pending_sale_shipments_action" model="ir.actions.act_window">
            <field name="name">Entregas pendientes</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">stock.picking</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="domain">[
                ('operation_type', '=', 'outgoing'),
                ('delivery_date', '=', False),
                ('shipping_guide_id', '=', False),
                ('sale_id', '!=', False)
            ]</field>
            <field name="view_id" eval="ref('stock.vpicktree')"/>
        </record>

        <menuitem id="pending_sale_shipments_menu" name="Entregas" action="pending_sale_shipments_action" sequence="10" parent="sale_stock_main_menu"/>

        <!-- pendientes por surtir -->

        <record id="stock_move_shipments_action" model="ir.actions.act_window">
            <field name="name">Pendientes por surtir</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">stock.move</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="domain">[
                ('picking_id.operation_type', '=', 'outgoing'),
                ('picking_id.delivery_date', '=', False),
                ('picking_id.shipping_guide_id', '=', False),
                ('picking_id.sale_id', '!=', False)
            ]</field>

        </record>

        <record model="ir.ui.view" id="stock_move_gi_shipments_tree">
            <field name="name">Pendientes por surtir</field>
            <field name="model">stock.move</field>
            <field name="arch" type="xml">
                <tree decoration-muted="state == 'cancel'" default_order="date_expected, picking_id, sequence" string="Pendientes por surtir">
                    <field name="date_expected" widget="date"/>
                    <field name="date" widget="date"/>
                    <field name="reference"/>
                    <field name="picking_id" string="Reference" invisible="1"/>
                    <field name="sequence" invisible="1"/>
                    <field name="origin"/>
                    <field name="product_id"/>
                    <field name="product_uom_qty"/>
                    <field name="product_uom" options="{'no_open': True, 'no_create': True}" string="Unit of Measure" groups="product.group_uom"/>
                    <field name="location_id" invisible="1"/>
                    <field name="location_dest_id" invisible="1"/>
                    <field name="create_date" invisible="1"/>
                    <field name="state"/>
                </tree>
            </field>
        </record>

        <menuitem id="pending_sale_stock_move_shipments_menu" name="Pendientes por surtir" action="stock_move_shipments_action" sequence="12" parent="sale_stock_main_menu"/>

    </data>
</odoo>